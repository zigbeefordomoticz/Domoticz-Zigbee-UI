"use strict";(self.webpackChunkz4d_plugin=self.webpackChunkz4d_plugin||[]).push([[577],{74577:(U,m,s)=>{s.r(m),s.d(m,{GroupModule:()=>B});var p=s(89417),g=s(93887),F=s(93331),_=s(38117),E=s(12298),f=s(28990),e=s(54438),G=s(88652),b=s(3366),d=s(19664),I=s(45794),j=s(38852),h=s(97013),c=s(46247),v=s(5779),k=s(22242);const C=["content"],N=()=>["_GroupId","GroupName"],T=()=>[10,25,50];function w(i,l){if(1&i){const t=e.RV6();e.EFF(0,"\n          "),e.j41(1,"div",12),e.EFF(2,"\n            "),e.j41(3,"span",13),e.EFF(4,"\n              "),e.nrm(5,"i",14),e.EFF(6,"\n              "),e.j41(7,"input",15),e.nI1(8,"translate"),e.bIt("input",function(o){e.eBV(t),e.XpG();const r=e.sdS(16);return e.Njj(r.filterGlobal(o.target.value,"contains"))}),e.k0s(),e.EFF(9,"\n            "),e.k0s(),e.EFF(10,"\n            "),e.j41(11,"button",16),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.add())}),e.k0s(),e.EFF(12,"\n          "),e.k0s(),e.EFF(13,"\n        ")}2&i&&(e.R7$(7),e.FS9("placeholder",e.bMT(8,1,"device.byname.placeholder")))}function S(i,l){1&i&&(e.EFF(0,"\n          "),e.j41(1,"tr"),e.EFF(2,"\n            "),e.nrm(3,"th"),e.EFF(4,"\n            "),e.j41(5,"th",17),e.EFF(6),e.nI1(7,"translate"),e.nrm(8,"p-sortIcon",18),e.EFF(9,"\n            "),e.k0s(),e.EFF(10,"\n            "),e.j41(11,"th",19),e.EFF(12),e.nI1(13,"translate"),e.nrm(14,"p-sortIcon",20),e.EFF(15,"\n            "),e.k0s(),e.EFF(16,"\n            "),e.j41(17,"th"),e.EFF(18),e.nI1(19,"translate"),e.k0s(),e.EFF(20,"\n            "),e.j41(21,"th"),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.EFF(24,"\n          "),e.k0s(),e.EFF(25,"\n        ")),2&i&&(e.R7$(6),e.SpI("\n              ",e.bMT(7,4,"group.create.shortid.column"),""),e.R7$(6),e.SpI("\n              ",e.bMT(13,6,"group.create.groupname.column"),""),e.R7$(6),e.SpI("\n              ",e.bMT(19,8,"group.create.devices.column"),"\n            "),e.R7$(4),e.SpI("\n              ",e.bMT(23,10,"group.create.coordinator.column"),"\n            "))}function R(i,l){if(1&i){const t=e.RV6();e.EFF(0,"\n                  "),e.j41(1,"input",29),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG().$implicit;return e.DH7(r.GroupName,o)||(r.GroupName=o),e.Njj(o)}),e.bIt("change",function(o){e.eBV(t);const r=e.XpG().$implicit,a=e.XpG();return e.Njj(a.updateValue(o,r._GroupId))}),e.k0s(),e.EFF(2,"\n                ")}if(2&i){const t=e.XpG().$implicit;e.R7$(),e.R50("ngModel",t.GroupName)}}function $(i,l){if(1&i){const t=e.RV6();e.EFF(0,"\n                  "),e.j41(1,"input",29),e.mxI("ngModelChange",function(o){e.eBV(t);const r=e.XpG().$implicit;return e.DH7(r.GroupName,o)||(r.GroupName=o),e.Njj(o)}),e.bIt("change",function(o){e.eBV(t);const r=e.XpG().$implicit,a=e.XpG();return e.Njj(a.updateValue(o,r._GroupId))}),e.k0s(),e.EFF(2,"\n                ")}if(2&i){const t=e.XpG().$implicit;e.R7$(),e.R50("ngModel",t.GroupName)}}function M(i,l){if(1&i&&(e.EFF(0,"\n                  "),e.j41(1,"span"),e.EFF(2,"\n                    "),e.j41(3,"b"),e.EFF(4,"Widget"),e.k0s(),e.EFF(5),e.j41(6,"b"),e.EFF(7,"IEEE"),e.k0s(),e.EFF(8),e.j41(9,"b"),e.EFF(10,"Ep"),e.k0s(),e.EFF(11),e.j41(12,"b"),e.EFF(13,"Id"),e.k0s(),e.EFF(14),e.j41(15,"b"),e.EFF(16),e.k0s(),e.EFF(17,"\n                  "),e.k0s(),e.EFF(18,"\n                ")),2&i){const t=l.item;e.R7$(5),e.SpI(" : ",t.Name," - "),e.R7$(3),e.SpI(" : ",t.IEEE," - "),e.R7$(3),e.SpI(" : ",t.Ep," -\n                    "),e.R7$(3),e.SpI(" : ",t._ID," -\n                    "),e.R7$(2),e.JRh(t.ZDeviceName)}}function V(i,l){if(1&i){const t=e.RV6();e.EFF(0,"\n          "),e.j41(1,"tr"),e.EFF(2,"\n            "),e.j41(3,"td"),e.EFF(4,"\n              "),e.j41(5,"i",21),e.nI1(6,"translate"),e.bIt("click",function(){const o=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.delete(o))}),e.k0s(),e.EFF(7,"\n            "),e.k0s(),e.EFF(8,"\n            "),e.j41(9,"td"),e.EFF(10),e.k0s(),e.EFF(11,"\n            "),e.j41(12,"td",22),e.EFF(13,"\n              "),e.j41(14,"p-cellEditor"),e.EFF(15,"\n                "),e.DNE(16,R,3,1,"ng-template",23),e.EFF(17,"\n                "),e.DNE(18,$,3,1,"ng-template",24),e.EFF(19,"\n              "),e.k0s(),e.EFF(20,"\n            "),e.k0s(),e.EFF(21,"\n            "),e.j41(22,"td"),e.EFF(23,"\n              "),e.j41(24,"ng-select",25),e.mxI("ngModelChange",function(o){const r=e.eBV(t).$implicit;return e.DH7(r.devicesSelected,o)||(r.devicesSelected=o),e.Njj(o)}),e.bIt("change",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.isFormValid())}),e.EFF(25,"\n                "),e.DNE(26,M,19,5,"ng-template",26),e.EFF(27,"\n              "),e.k0s(),e.EFF(28,"\n            "),e.k0s(),e.EFF(29,"\n            "),e.j41(30,"td"),e.EFF(31,"\n              "),e.j41(32,"div",27),e.EFF(33,"\n                "),e.j41(34,"input",28),e.bIt("click",function(o){const r=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.updateCoordinator(o,r))}),e.k0s(),e.EFF(35,"\n              "),e.k0s(),e.EFF(36,"\n            "),e.k0s()()}if(2&i){const t=l.$implicit,n=e.XpG();e.R7$(5),e.FS9("title",e.bMT(6,9,"group.create.delete.button")),e.R7$(5),e.SpI("\n              ",t._GroupId,"\n            "),e.R7$(2),e.Y8G("pEditableColumn",t.GroupName),e.R7$(12),e.Y8G("items",n.devices)("multiple",!0)("closeOnSelect",!1)("searchable",!0),e.R50("ngModel",t.devicesSelected),e.R7$(10),e.Y8G("checked",t.coordinatorInside)}}function y(i,l){if(1&i){const t=e.RV6();e.EFF(0,"\n    "),e.j41(1,"div",30),e.EFF(2,"\n      "),e.nrm(3,"h4",31),e.EFF(4,"\n      "),e.j41(5,"button",32),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.dismiss("Cross click"))}),e.k0s(),e.EFF(6,"\n    "),e.k0s(),e.EFF(7,"\n    "),e.nrm(8,"div",33),e.EFF(9,"\n    "),e.j41(10,"div",34),e.EFF(11,"\n      "),e.j41(12,"button",35),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.dismiss("cancel"))}),e.k0s(),e.EFF(13,"\n    "),e.k0s(),e.EFF(14,"\n  ")}}const x=new _.Vy("GroupComponent"),D=[{path:"",component:(()=>{class i extends f.U{modalService;apiService;formBuilder;translate;toastr;headerService;content;form;rows=[];rowsTemp=[];devices;temp=[];hasEditing=!1;waiting=!1;constructor(t,n,o,r,a,u){super(),this.modalService=t,this.apiService=n,this.formBuilder=o,this.translate=r,this.toastr=a,this.headerService=u}ngOnInit(){this.apiService.getZGroupDevicesAvalaible().subscribe(t=>{const n=[];t&&t.length>0&&(t.forEach(o=>{o.WidgetList.forEach(r=>{if("0000"!==o._NwkId){const a=new E.ij;a.Ep=r.Ep,a.IEEE=r.IEEE,a.Name=r.Name,a.ZDeviceName=r.ZDeviceName,a._ID=r._ID,a._NwkId=o._NwkId,n.push(a)}})}),this.devices=[...n],this.getGroups())})}updateValue(t,n){this.hasEditing=!0,this.rows.find(r=>r._GroupId===n).GroupName=t.target.value}updateDevices(){this.rows.forEach(t=>{t.coordinatorInside&&(t.devicesSelected||(t.devicesSelected=[]),t.devicesSelected.push({Ep:"01",_NwkId:"0000"}))}),this.isFormValid&&this.apiService.putZGroups(this.rows).subscribe(t=>{x.debug(this.rows),this.hasEditing=!1,this.toastr.success(this.translate.instant("api.global.succes.saved.notify")),this.apiService.getRestartNeeded().subscribe(n=>{1===n.RestartNeeded&&(this.headerService.setRestart(!0),this.open(this.content))}),this.waiting=!0,setTimeout(()=>{this.getGroups(),this.waiting=!1},1e3)})}delete(t){const n=this.rows.indexOf(t,0);n>-1&&(this.rows.splice(n,1),this.rows=[...this.rows],this.temp=[...this.rows])}add(){const t=new E.YJ;t.GroupName="",t.coordinatorInside=!1,this.rows.push(t),this.rows=[...this.rows],this.temp=[...this.rows]}updateCoordinator(t,n){n.coordinatorInside=t.currentTarget.checked}open(t){this.modalService.open(t,{ariaLabelledBy:"modal-basic-title"}).result.then(n=>{},n=>{})}isFormValid(){let t=!0;return this.rows.forEach(n=>{n.GroupName&&(n.coordinatorInside||n.devicesSelected&&0!==n.devicesSelected.length)||(t=!1)}),!this.waiting&&t}getGroups(){this.apiService.getZGroups().subscribe(t=>{t&&t.length>0&&(t.forEach(n=>{const o=[];n.coordinatorInside=!1,n.Devices.forEach(r=>{if("0000"===r._NwkId)n.coordinatorInside=!0;else{const a=this.devices.find(u=>u._NwkId===r._NwkId&&u.Ep===r.Ep);null!=a&&o.push(a)}}),n.devicesSelected=o}),this.rows=[...t],this.temp=[...t])})}static \u0275fac=function(n){return new(n||i)(e.rXU(G.Bq),e.rXU(b.G),e.rXU(p.ok),e.rXU(d.c$),e.rXU(I.tw),e.rXU(j.d))};static \u0275cmp=e.VBU({type:i,selectors:[["app-group"]],viewQuery:function(n,o){if(1&n&&e.GBs(C,5),2&n){let r;e.mGM(r=e.lsd())&&(o.content=r.first)}},features:[e.Vt3],decls:32,vars:20,consts:[["dt1",""],["content",""],[1,"card"],[1,"card-header","fw-bold"],["translate","group.create.validate.button",1,"btn","btn-primary","float-end",3,"click","disabled"],[1,"card-body"],[1,"card-text",3,"innerHTML"],[1,"card-text"],["styleClass","p-datatable-sm","dataKey","_GroupId","responsiveLayout","scroll",3,"globalFilterFields","rowHover","showCurrentPageReport","currentPageReportTemplate","rowsPerPageOptions","value","rows","paginator","scrollable"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"d-flex","justify-content-between"],[1,"p-input-icon-left","ml-auto"],[1,"pi","pi-search"],["pInputText","","type","text",1,"w-75",3,"input","placeholder"],["translate","group.create.add.button",1,"btn","btn-primary",3,"click"],["pSortableColumn","_GroupId",2,"width","8rem"],["field","_GroupId"],["pSortableColumn","GroupName",2,"width","10rem"],["field","GroupName"],[1,"fa","fa-trash",2,"cursor","pointer",3,"click","title"],["pEditableColumnField","GroupName",3,"pEditableColumn"],["pTemplate","input"],["pTemplate","output"],["bindLabel","Name","placeholder","Choose device","appendTo","body",3,"ngModelChange","change","items","multiple","closeOnSelect","searchable","ngModel"],["ng-option-tmp",""],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"click","checked"],["pInputText","","type","text",3,"ngModelChange","change","ngModel"],[1,"modal-header"],["id","modal-basic-title","translate","group.reloadplugin.alert.title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["translate","group.reloadplugin.alert.subject",1,"modal-body"],[1,"modal-footer"],["type","button","translate","group.reloadplugin.alert.cancel",1,"btn","btn-outline-dark",3,"click"]],template:function(n,o){if(1&n){const r=e.RV6();e.j41(0,"div",2),e.EFF(1,"\n  "),e.j41(2,"div",3),e.EFF(3),e.nI1(4,"translate"),e.j41(5,"button",4),e.bIt("click",function(){return e.eBV(r),e.Njj(o.updateDevices())}),e.k0s(),e.EFF(6,"\n  "),e.k0s(),e.EFF(7,"\n  "),e.j41(8,"div",5),e.EFF(9,"\n    "),e.nrm(10,"p",6),e.nI1(11,"translate"),e.EFF(12,"\n    "),e.j41(13,"div",7),e.EFF(14,"\n      "),e.j41(15,"p-table",8,0),e.nI1(17,"translate"),e.EFF(18,"\n        "),e.DNE(19,w,14,3,"ng-template",9),e.EFF(20,"\n        "),e.DNE(21,S,26,12,"ng-template",10),e.EFF(22,"\n        "),e.DNE(23,V,37,11,"ng-template",11),e.EFF(24,"\n      "),e.k0s(),e.EFF(25,"\n    "),e.k0s(),e.EFF(26,"\n  "),e.k0s(),e.EFF(27,"\n\n  "),e.DNE(28,y,15,0,"ng-template",null,1,e.C5r),e.EFF(30,"\n"),e.k0s(),e.EFF(31,"\n")}2&n&&(e.R7$(3),e.SpI("\n    ",e.bMT(4,12,"group.create.header"),""),e.R7$(2),e.Y8G("disabled",!o.isFormValid()),e.R7$(5),e.Y8G("innerHTML",e.bMT(11,14,"group.create.subtitle"),e.npT),e.R7$(5),e.FS9("currentPageReportTemplate",e.bMT(17,16,"TOTAL")),e.Y8G("globalFilterFields",e.lJ4(18,N))("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",e.lJ4(19,T))("value",o.rows)("rows",10)("paginator",!0)("scrollable",!0))},dependencies:[p.me,p.BC,p.vS,h.vr,h.Uq,d.Mm,c.XI,v.Ei,c.Tg,c.hp,c.c5,c.yc,k.S,d.D9]})}return i})(),data:{title:(0,_.o6)("group")}}];let X=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=e.$C({type:i});static \u0275inj=e.G2t({imports:[F.iI.forChild(D),F.iI]})}return i})(),B=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=e.$C({type:i});static \u0275inj=e.G2t({imports:[X,g.G,p.YN]})}return i})()}}]);